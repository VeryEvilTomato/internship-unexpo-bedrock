import React, {useEffect, useState} from 'react';
import {connect} from 'react-redux';

import {Button, Text, Divider} from 'react-native-elements';

import {View} from 'react-native';

import GateButton from '../GateButton';
import UserBoard from '../UserBoard';
import {invalidateToken} from '@redux/actions';
import {requestProfile} from '@api';
import {FORM_INIT} from '@constants';

const HomeScreenComponent = ({request, dispatch, navigation}) => {
  const [user, setUser] = useState({
    ...FORM_INIT.USER,
    usersdata: FORM_INIT.USER_DATA,
  });

  useEffect(() => {
    if (request.userId) {
      requestProfile(request.userId, request.baseURL, request.token)
        .then(response => {
          setUser(response.data);
        })
        .catch(error => {
          console.log(error);
          dispatch(invalidateToken());
        });
    }
  }, [dispatch, request.baseURL, request.token, request.userId]);

  return (
    <View>
      {userId === null ? (
        <Text>Cargando perfil...</Text>
      ) : (
        <UserBoard userData={user} />
      )}
      <GateButton />
      <Divider />
      {user.usersdata.accessLevel === 'AL' ? (
        <Button
          title="GestiÃ³n de usuarios"
          onPress={() => navigation.navigate('UserManagement')}
        />
      ) : (
        <View />
      )}
      <Button
        title="Opciones"
        onPress={() => navigation.navigate('Settings')}
      />
    </View>
  );
};

export const HomeScreen = connect(state => state)(HomeScreenComponent);
